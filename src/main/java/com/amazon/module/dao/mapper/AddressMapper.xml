<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.amazon.module.dao.AddressDao">

    <resultMap type="address" id="addressMapper">
        <id property="aid" column="aid"/>
        <result property="country" column="country"/>
        <result property="province" column="province"/>
        <result property="city" column="city"/>
        <result property="detail" column="detail"/>
        <result property="userId" column="user_id"/>
        <result property="phone" column="phone"/>
        <result property="receiver" column="receiver"/>
        <result property="zipCode" column="zip_code"/>
        <result property="status" column="status"/>
    </resultMap>

    <!--插入用户-->
    <insert id="addNewAddress" parameterType="address">
        <selectKey resultType="java.lang.String" order="BEFORE" keyProperty="aid">
            select sys_guid() from dual
        </selectKey>
        insert into ADDRESS(aid,country,province,city,detail,user_id,phone,receiver,zip_code)
        values(#{aid},#{country},#{province},#{city},#{detail},#{userId},#{phone},#{receiver},#{zipCode})
    </insert>

    <!--将当前用户的所有地址状态设置成非默认-->
    <update id="updateAddressStatusToNull">
        update ADDRESS set status=null where user_id=#{userId}
    </update>

    <!--将指定地址的状态设置成默认地址-->
    <update id="updateAddressStatusToDefault">
        update ADDRESS set status='1' where aid=#{aid} and user_id=#{userId}
    </update>


    <!--通过用户id查询地址-->
    <select id="queryMyAddress"  resultMap="addressMapper">
        select
                *
        from ADDRESS t where user_id=#{userId} order by status
    </select>

</mapper>