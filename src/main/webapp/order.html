<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="images/icon/logo.png"/>
    <!--框架-->
    <link rel="stylesheet" href="lib/iview/iview.css">
    <link rel="stylesheet" href="lib/bootstrap/bootstrap.css">
    <!--css-->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/order.css">
    <!--框架-->
    <script src="lib/vue/vuePlus.js"></script>
    <script src="lib/iview/iview.min.js"></script>
    <script src="lib/jquery/jquery-3.2.1.js"></script>
    <script src="lib/bootstrap/bootstrap.js"></script>
    <!--js-->
    <!--模块-->
    <script src="module/topUserInfo/topUserInfo.js"></script>
    <script src="module/orderUnit/orderUnit.js"></script>
    <title>亚马逊(订单)</title>
</head>
<body style="overflow-y: auto">
<div id="order">
    <top-user-info></top-user-info>
    <div class="my_container">
        <div class="order_header">
            <div class="order_header_logo">
                <img src="images/use/index.png" alt="">
            </div>
            <div class="order_header_steps">
                <steps :current="0">
                    <step title="下订单"></step>
                    <Step title="付款"></Step>
                    <Step title="确认收货"></Step>
                    <Step title="评价"></Step>
                </steps>
            </div>
        </div>
        <div class="order_address">
            <h3>收货地址：</h3>
            <ul style="overflow: hidden">
                <li v-for="item in addrs" class="order_address_unit">
                    <div :class="{order_address_selected:item.selected}"  @click="changeAddress(item)">
                        <div>收件人：{{item.name}}</div>
                        <div>地址：{{item.addr}}</div>
                        <div>联系方式:{{item.phone}}</div>
                    </div>
                </li>
            </ul>
            <div>
                <i-button type="primary" @click="addAddr.modal=true">新增收货地址</i-button>
            </div>
        </div>
        <div class="order_info">
            <h4 style="font-weight: 600">确认订单信息</h4>
            <div class="order_info_wrap">
               <div class="store_order_wrap" v-for="storeInfo in orderList">
                   <div><img src="images/icon/store.png" alt="">{{storeInfo.store}}</div>
                   <div class="order_info_headers">
                       <row>
                           <i-col span="6">
                               <div class="order_info_header">商品信息</div>
                           </i-col>
                           <i-col span="6">
                               <div class="order_info_header">分类</div>
                           </i-col>
                           <i-col span="3">
                               <div class="order_info_header">单价</div>
                           </i-col>
                           <i-col span="6">
                               <div class="order_info_header">数量</div>
                           </i-col>
                           <i-col span="3">
                               <div class="order_info_header">小计</div>
                           </i-col>
                       </row>
                   </div>
                   <order-unit v-for="order in storeInfo.orders" :order-info="order"></order-unit>
               </div>
            </div>
            <div class="order_final_info">
                <div>实付款:<span class="price_text">￥{{sumCost}}</span></div>
                <div>地址：<span>中国北池子村</span></div>
                <div>收件人：<span>某某某(110)</span></div>
            </div>
            <div class="clearfix"></div>
            <div style="margin-top: 20px;overflow: hidden">
                <i-button type="primary" @click="submitOrder" class="pull-right">提交订单</i-button>
            </div>
        </div>
    </div>
    <!--新增地址-->
    <modal v-model="addAddr.modal" width="450" @on-cancel="" :mask-closable="false">
        <p slot="header" style="color:black;text-align:center">
            <span>添加地址</span>
        </p>
        <div style="text-align:center">
            <i-form ref="addAddress" :model="addAddr.info" :rules="addAddr.rules" :label-width="80">
                <form-item label="所在地区" prop="country">
                    <row>
                        <i-col span="8">
                            <form-item prop="country">
                                <i-select v-model="addAddr.info.country" style="width:100px">
                                    <i-option v-for="item in countryList" :value="item.id" :key="item.id">{{ item.name }}</i-option>
                                </i-select>
                            </form-item>
                        </i-col>
                        <i-col span="8">
                            <form-item prop="province">
                                <i-select v-model="addAddr.info.province" style="width:100px">
                                    <i-option v-for="item in provinceList" :value="item.id" :key="item.id">{{ item.name }}</i-option>
                                </i-select>
                            </form-item>
                        </i-col>
                        <i-col span="8">
                            <form-item prop="city">
                                <i-select v-model="addAddr.info.city" style="width:100px">
                                    <i-option v-for="item in cityList" :value="item.id" :key="item.id">{{ item.name }}</i-option>
                                </i-select>
                            </form-item>
                        </i-col>
                    </row>
                </form-item>
                <form-item label="详细地址" prop="address">
                    <i-input v-model="addAddr.info.address" type="textarea" rows="4" placeholder="输入详细地址(县、区/乡、镇、街道/村、小区/门牌号)"></i-input>
                </form-item>
                <form-item label="邮政编码" prop="postalCode">
                    <i-input v-model="addAddr.info.postalCode" placeholder="邮政编码"></i-input>
                </form-item>
                <form-item label="收货人姓名" prop="receiverName">
                    <i-input v-model="addAddr.info.receiverName" placeholder="收件人姓名"></i-input>
                </form-item>
                <form-item label="联系方式" prop="phone">
                    <i-input v-model="addAddr.info.phone" placeholder="手机号/固话(请加区号)"></i-input>
                </form-item>
                <form-item>
                    <i-button type="primary" @click="saveNewAddress('addAddress')" :loading="addAddr.saveFlag">保存</i-button>
                    <i-button type="ghost" @click="reset('addAddress')" style="margin-left: 8px">重置</i-button>
                </form-item>
            </i-form>
        </div>
        <div slot="footer"></div>
    </modal>
</div>
<script>
    var app=new Vue({
        el:'#order',
        data:{
            addrs:[
                {
                    name:111,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:true
                },
                {
                    name:222,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:false
                },
                {
                    name:333,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:false
                },
                {
                    name:444,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:false
                },
                {
                    name:555,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:false
                },
                {
                    name:666,
                    phone:'1654115654654',
                    addr:'中国北池子村',
                    selected:false
                }
            ],
            addAddr:{
                modal:false,
                info:{
                    country:'1',
                    province:'',
                    city:'',
                    address:'',
                    postalCode:'',
                    receiverName:'',
                    phone:''
                },
                rules:{
                    country: [
                        { required:true , message:'国家'}
                    ],
                    province: [
                        { required:true , message:'省份'}
                    ],
                    city: [
                        { required:true , message:'城市'}
                    ],
                    address: [
                        { required:true , message:'填写详细地址'}
                    ],
                    postalCode: [
                        { message:'邮政编码错误'}
                    ],
                    receiverName: [
                        { required:true , message:'收件人姓名为空'}
                    ],
                    phone: [
                        { required:true , message:'请填写正确的联系方式'}
                    ],
                },
                saveFlag:false
            },
            countryList:[
                {id:'1',name:'中国'},
                {id:'2',name:'美国'},
                {id:'3',name:'英国'},
                {id:'4',name:'日本'},
            ],
            provinceList:[
                {id:'1',name:'江苏'},
                {id:'2',name:'广州'},
                {id:'3',name:'江西'},
                {id:'4',name:'山东'},
            ],
            cityList:[
                {id:'1',name:'连云港'},
                {id:'2',name:'苏州'},
                {id:'3',name:'无锡'},
                {id:'4',name:'扬州'},
            ],
            orderList:[
                {
                    store:'京天华盛',
                    model:false,
                    orders:[
                        {
                            img:'images/product/1.jpg',
                            desc:'不拉不拉不拉',
                            category:'不拉不拉不拉',
                            price:1122.00,
                            count:1,
                            cost:1122.00,
                            model:false
                        },
                    ]
                },
                {
                    store:"名龙堂",
                    model:false,
                    orders:[
                        {
                            img:'images/product/1.jpg',
                            desc:'不拉不拉不拉',
                            category:'不拉不拉不拉',
                            price:1122.00,
                            count:1,
                            cost:1122.00,
                            model:false
                        },
                        {
                            img:'images/product/1.jpg',
                            desc:'不拉不拉不拉',
                            category:'不拉不拉不拉',
                            price:1122.00,
                            count:1,
                            cost:1122.00,
                            model:false
                        },
                    ]
                },
            ],
            sumCost:9999.99
        },
        methods:{
            changeAddress:function(addr){
                for(var i in this.addrs){
                    this.addrs[i].selected=false;
                }
                addr.selected=true;
            },
            saveNewAddress:function (name) {
                this.$refs[name].validate((result)=> {
                    if(result){
                        this.addAddr.saveFlag = true;
                        setTimeout(() => {
                            this.addAddr.modal = false;
                            this.addAddr.saveFlag = false;
                            this.$Message.success('保存成功');
                            this.reset("addAddress");
                        }, 2000);
                    }
                });
            },
            reset:function (name) {
                this.$refs[name].resetFields();
            },
            submitOrder:function () {
                console.log("submit order")
            }
        }
    });
</script>
</body>
</html>